<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cipher Lounge - Encrypted Messages</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-black to-gray-900 text-white font-mono min-h-screen flex flex-col">

  <!-- NAVBAR -->
  <%- include('./partials/header') %>

  <!-- HERO TITLE -->
  <section class="text-center mt-20 px-6 relative">
    <!-- green glow -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[400px] bg-green-500/20 rounded-full blur-3xl"></div>

    <h1 class="text-5xl md:text-6xl font-extrabold mb-4 relative z-10 hero-title">
      Admin Logs
    </h1>
    <p class="text-gray-400 max-w-xl mx-auto mb-10 relative z-10 hero-sub">
      Every action leaves a trace. Monitor encrypted activity from behind the veil.
    </p>

    <% if (user) { %>
      <a href="/messages/new" class="px-4 py-2 relative rounded-full bg-green-500/90 text-white hover:bg-green-400 transition mb-5">
        New Message
      </a>
    <% } %>
  </section>

  <!-- MESSAGE LOG CARDS -->
  <section class="max-w-4xl mx-auto min-w-[500px] px-6 space-y-8 mb-20 log-cards">
    <% if (messages && messages.length) { %>
      <% messages.forEach(m => { %>
        <div class="bg-white/5 border border-green-400/20 rounded-2xl shadow-lg p-6 space-y-3 hover:border-green-400 transition">
          <div class="flex justify-between text-sm text-gray-500">
            <% if (user) { %>
              <span class="text-green-400 font-semibold">🧑‍💻 <%= m.username %></span>
              <span><%= new Date(m.created_at).toLocaleString() %></span>
            <% } else { %>
              <span class="text-green-400 font-semibold">🧑‍💻 —</span>
              <span>—</span>
            <% } %>
          </div>

          <h3 class="text-xl text-green-300 font-semibold"><%= m.subject %></h3>
          <p class="text-gray-300"><%= m.body %></p>

          <% if (user.is_admin == true && user.id === m.author_id) { %>
            <form method="POST" action="/messages/<%= m.id %>/delete" class="mt-2">
              <button class="px-3 py-1 rounded bg-red-500 hover:bg-red-400 text-white text-sm">DELETE</button>
            </form>
          <% } %>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-center text-gray-400">No messages yet.</p>
    <% } %>
  </section>

  <!-- FOOTER -->
  <%- include('./partials/footer') %>

  <!-- GSAP ANIMATIONS -->
  <script>
    gsap.fromTo(".hero-title", { x: -1000 }, { x: 0, duration: 1, ease: "power1.out" });
    gsap.fromTo(".hero-sub", { opacity: 0, y: 80 }, { opacity: 1, y: 0, duration: 1, delay: 0.3, ease: "power4.out" });
    gsap.fromTo(".log-cards > div", {
      opacity: 0,
      y: 50,
      scale: 0.96
    }, {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.8,
      ease: "power2.out",
      stagger: 0.15,
      delay: 0.5
    });
  </script>
</body>
</html>
